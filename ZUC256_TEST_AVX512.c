#include"ZUC256_AVX512.h"
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <time.h>

/***********************************************************************************
Control switch:1 for single thread, and 0 for multi-thread
************************************************************************************/
#define single_thread 1


////////////////////////////////////////////////////////////////////////////////////////////////
#define PARALLEL_NUM 16
#define	MAXBYTELEN 32768
#define TOTXTFILE single_thread
///////////////////////////////////////////////////////////////////////////////////////////////////////
double totalspeed = 0;

void ZUC256_SelfTest_AVX512()
{
#define KEY_LEN 32 // key byte length
#define IV_LEN 25 // iv byte length : iv[0~16] is 8 bit, iv[17~24] is 6 bit
#define KS_LEN 32 // keystream byte length
#define TEST_NUM 34 // the number of standard test

	u8 k_std[KEY_LEN * TEST_NUM] =
	{
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
		0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
		0x2d,0x20,0x86,0x83,0x2c,0xc2,0xfe,0x3f,0xd1,0x8c,0xb5,0x1d,0x6c,0x5e,0x99,0xa5,
		0x75,0x9f,0x02,0x21,0x1f,0x85,0xe5,0xff,0x2f,0x90,0x4a,0x78,0x0f,0x58,0x00,0x6f,
		0x30,0x1c,0x4e,0x83,0x77,0x19,0x26,0xcf,0x51,0x88,0x21,0x49,0xe7,0x00,0x4a,0x5f,
		0x37,0x99,0x29,0x06,0xb6,0xfe,0x8c,0x66,0x3a,0xc3,0x87,0xd3,0x18,0xf9,0xb9,0x00,
		0x33,0x19,0x17,0x82,0xc1,0x70,0x4f,0x60,0xd0,0x84,0x8d,0x75,0x62,0xa2,0xfa,0x19,
		0xf9,0x92,0x4f,0xea,0x4e,0x77,0x33,0xcd,0x45,0xf6,0xc3,0x2f,0x21,0x9a,0x72,0x91,
		0x36,0x15,0xdf,0x81,0x0c,0xc6,0x77,0xf1,0x50,0x80,0xfa,0xa1,0xdd,0x44,0xaa,0xd3,
		0xbb,0x8b,0x76,0xcf,0xe5,0xf0,0xd9,0x33,0x50,0x29,0x00,0x8b,0x2a,0x3b,0x2b,0x21,
		0x3a,0x11,0xa7,0x81,0x56,0x1d,0xa0,0x82,0xd0,0x7c,0x66,0xcd,0x58,0xe7,0x5a,0x8d,
		0x7d,0x84,0x9d,0xb4,0x7d,0x69,0x80,0x9a,0x5b,0x5c,0x3c,0xe6,0x33,0xdc,0xe4,0xb2,
		0x3d,0x0e,0x6f,0x80,0xa1,0x74,0xc8,0x12,0x4f,0x78,0xd2,0xf9,0xd2,0x89,0x0a,0x47,
		0x3f,0x7d,0xc4,0x98,0x14,0xe1,0x27,0x00,0x66,0x8e,0x79,0x42,0x3c,0x7d,0x9d,0x43,
		0x40,0x0a,0x37,0x7f,0xeb,0xcb,0xf1,0xa3,0xcf,0x73,0x3e,0x25,0x4d,0x2b,0xba,0x01,
		0x01,0x77,0xea,0x7d,0xac,0x5a,0xce,0x67,0x71,0xc1,0xb5,0x9e,0x45,0x1f,0x55,0xd4,
		0x44,0x07,0xff,0x7e,0x36,0x21,0x19,0x34,0x4e,0x6f,0xaa,0x51,0xc8,0xce,0x6b,0xbc,
		0xc3,0x70,0x11,0x62,0x43,0xd3,0x75,0xce,0x7c,0xf4,0xf2,0xfa,0x4e,0xc0,0x0e,0x64,
		0x47,0x03,0xc8,0x7e,0x81,0x78,0x42,0xc4,0xce,0x6b,0x16,0x7d,0x43,0x70,0x1b,0x76,
		0x85,0x69,0x38,0x46,0xdb,0x4c,0x1b,0x34,0x87,0x27,0x2e,0x55,0x57,0x61,0xc7,0xf5,
		0x4a,0x00,0x90,0x7d,0xcb,0xcf,0x6a,0x55,0x4e,0x67,0x82,0xa9,0xbe,0x12,0xcb,0x30,
		0x47,0x62,0x5e,0x2b,0x72,0xc5,0xc2,0x9b,0x92,0x59,0x6b,0xb1,0x60,0x02,0x80,0x86,
		0x4d,0xfc,0x58,0x7c,0x16,0x26,0x93,0xe6,0xcd,0x63,0xee,0xd5,0x39,0xb5,0x7b,0xea,
		0x09,0x5c,0x85,0x10,0x0a,0x3e,0x69,0x01,0x9d,0x8c,0xa7,0x0d,0x69,0xa3,0x39,0x17,
		0x51,0xf8,0x20,0x7c,0x60,0x7c,0xbb,0x77,0x4d,0x5f,0x5a,0x01,0xb4,0x57,0x2b,0xa4,
		0xcb,0x55,0xac,0xf4,0xa1,0xb7,0x10,0x68,0xa8,0xbf,0xe4,0x68,0x72,0x44,0xf2,0xa7,
		0x54,0xf5,0xe8,0x7b,0xab,0xd3,0xe3,0x07,0xcc,0x5b,0xc6,0x2d,0x2f,0xf9,0xdb,0x5e,
		0x8c,0x4e,0xd3,0xd9,0x39,0x30,0xb7,0xcf,0xb3,0xf2,0x21,0xc4,0x7b,0xe5,0xab,0x38,
		0x57,0xf1,0xb0,0x7a,0xf5,0x2a,0x0c,0x98,0x4c,0x57,0x33,0x59,0xa9,0x9c,0x8c,0x18,
		0x4e,0x47,0xf9,0xbe,0xd0,0xa9,0x5e,0x35,0xbe,0x25,0x5d,0x20,0x83,0x86,0x64,0xc9,
		0x5a,0xee,0x79,0x7a,0x40,0x81,0x34,0x29,0xcb,0x53,0x9f,0x85,0x24,0x3e,0x3c,0xd2,
		0x10,0x40,0x20,0xa2,0x68,0x22,0x04,0x9c,0xc9,0x57,0x9a,0x7b,0x8c,0x27,0x1d,0x5a,
		0x5e,0xea,0x41,0x79,0x8b,0xd7,0x5d,0xba,0x4b,0x4f,0x0b,0xb1,0x9f,0xe0,0xec,0x8c,
		0xd2,0x3a,0x47,0x87,0xff,0x9b,0xab,0x02,0xd4,0x8a,0xd6,0xd7,0x95,0xc8,0xd6,0xea,
		0x61,0xe6,0x09,0x78,0xd5,0x2e,0x85,0x4a,0xcb,0x4b,0x77,0xdd,0x1a,0x83,0x9c,0x46,
		0x94,0x33,0x6e,0x6c,0x97,0x14,0x52,0x69,0xdf,0xbd,0x13,0x33,0x9e,0x69,0x8f,0x7b,
		0x64,0xe3,0xd1,0x78,0x20,0x85,0xae,0xdb,0x4a,0x47,0xe3,0x09,0x95,0x25,0x4c,0x00,
		0x56,0x2c,0x94,0x50,0x2e,0x8d,0xf9,0xd0,0xea,0xf0,0x4f,0x8e,0xa7,0x0a,0x48,0x0c,
		0x67,0xdf,0x99,0x77,0x6a,0xdb,0xd6,0x6c,0xca,0x43,0x4f,0x35,0x10,0xc7,0xfc,0xbb,
		0x18,0x25,0xbb,0x35,0xc6,0x06,0xa0,0x36,0xf5,0x22,0x8c,0xea,0xb0,0xab,0x01,0x9c,
		0x6b,0xdc,0x61,0x76,0xb5,0x32,0xff,0xfc,0x49,0x3f,0xbb,0x61,0x8b,0x6a,0xad,0x75,
		0xda,0x1f,0xe2,0x1a,0x5d,0x7f,0x47,0x9d,0x00,0x55,0xc8,0x46,0xb9,0x4c,0xba,0x2d,
		0x6e,0xd8,0x2a,0x76,0xff,0x89,0x27,0x8d,0xc9,0x3b,0x27,0x8e,0x06,0x0c,0x5d,0x2f,
		0x9c,0x18,0x08,0xfe,0xf5,0xf8,0xed,0x03,0x0b,0x88,0x05,0xa1,0xc2,0xed,0x73,0xbe,
		0x71,0xd4,0xf2,0x75,0x4a,0xe0,0x4f,0x1e,0x49,0x36,0x93,0xba,0x80,0xae,0x0d,0xe9,
		0x5e,0x11,0x2f,0xe3,0x8c,0x70,0x94,0x6a,0x16,0xbb,0x42,0xfd,0xcb,0x8f,0x2c,0x4f,
		0x74,0xd1,0xba,0x74,0x95,0x36,0x78,0xaf,0xc8,0x32,0xff,0xe6,0xfb,0x51,0xbd,0xa3,
		0x20,0x0a,0x56,0xc8,0x24,0xe9,0x3b,0xd1,0x21,0xee,0x7e,0x59,0xd4,0x30,0xe5,0xdf,
		0x78,0xcd,0x82,0x73,0xdf,0x8d,0xa0,0x3f,0x48,0x2e,0x6b,0x12,0x76,0xf3,0x6d,0x5d,
		0xe2,0x03,0x7d,0xac,0xbb,0x62,0xe2,0x37,0x2c,0x20,0xbb,0xb4,0xdd,0xd1,0x9e,0x70,
		0x7b,0xca,0x4a,0x73,0x2a,0xe4,0xc9,0xd0,0xc7,0x2a,0xd8,0x3e,0xf1,0x95,0x1d,0x17,
		0xa4,0xfd,0xa3,0x91,0x53,0xdb,0x89,0x9e,0x37,0x53,0xf7,0x10,0xe6,0x72,0x56,0x01,
		0x7e,0xc6,0x12,0x72,0x74,0x3b,0xf1,0x61,0x47,0x26,0x44,0x6a,0x6c,0x38,0xce,0xd1,
		0x66,0xf6,0xca,0x76,0xeb,0x54,0x30,0x04,0x42,0x86,0x34,0x6c,0xef,0x13,0x0f,0x92,
		0x82,0xc2,0xdb,0x71,0xbf,0x91,0x1a,0xf2,0xc7,0x22,0xb0,0x96,0xe7,0xda,0x7e,0x8b,
		0x28,0xef,0xf1,0x5a,0x82,0xcd,0xd6,0x6b,0x4d,0xb9,0x70,0xc8,0xf8,0xb4,0xc8,0x22,
		0x85,0xbf,0xa3,0x71,0x09,0xe8,0x42,0x82,0x46,0x1e,0x1c,0xc2,0x62,0x7c,0x2e,0x45,
		0xea,0xe8,0x17,0x3f,0x1a,0x46,0x7d,0xd1,0x58,0xeb,0xad,0x23,0x01,0x55,0x81,0xb3,
		0x88,0xbb,0x6b,0x70,0x54,0x3f,0x6b,0x13,0xc6,0x1a,0x88,0xee,0xdd,0x1f,0xde,0xff,
		0xac,0xe2,0x3e,0x24,0xb1,0xbf,0x24,0x38,0x63,0x1e,0xe9,0x7f,0x0a,0xf6,0x3a,0x44,
		0x8b,0xb8,0x33,0x6f,0x9f,0x95,0x93,0xa4,0x45,0x16,0xf4,0x1a,0x57,0xc1,0x8e,0xba,
		0x6e,0xdb,0x65,0x08,0x49,0x38,0xcb,0x9f,0x6e,0x51,0x26,0xdb,0x13,0x97,0xf3,0xd5,
		0x8f,0xb4,0xfb,0x6f,0xe9,0xec,0xbc,0x34,0xc5,0x12,0x60,0x46,0xd2,0x63,0x3e,0x74,
		0x30,0xd4,0x8c,0xed,0xe0,0xb1,0x72,0x05,0x79,0x84,0x62,0x36,0x1c,0x38,0xac,0x65,
		0x92,0xb0,0xc4,0x6e,0x34,0x43,0xe4,0xc5,0x44,0x0e,0xcc,0x72,0x4d,0x06,0xee,0x2e,
		0xf2,0xcd,0xb2,0xd2,0x78,0x2a,0x18,0x6c,0x84,0xb7,0x9f,0x92,0x25,0xd9,0x65,0xf6,
	};
	u8 iv_std[IV_LEN * TEST_NUM] =
	{
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
		0xff,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
		0x1e,0x89,0x8f,0x9c,0x4b,0x2c,0x6e,0xe9,0xe2,0x28,0x76,0x1c,0xa5,0x08,0x97,0xb7,
		0x1f,0x3e,0x0a,0x1c,0x35,0x28,0x06,0x35,0x3e,
		0x89,0x00,0xd1,0x6f,0x53,0x9d,0x51,0x2c,0xa5,0x4c,0x92,0xbb,0x42,0xd8,0x08,0x4f,
		0xe1,0x28,0x08,0x3d,0x14,0x1c,0x07,0x2f,0x29,
		0xf4,0x77,0x13,0x43,0x5a,0x0e,0x34,0x6f,0x67,0x71,0xae,0x5a,0xde,0xa8,0x7a,0xe7,
		0xa4,0x12,0x06,0x1d,0x34,0x0f,0x08,0x29,0x13,
		0x5f,0xee,0x55,0x17,0x62,0x7f,0x17,0xb2,0x2a,0x96,0xca,0xf9,0x7b,0x77,0xec,0x7f,
		0x66,0x3c,0x04,0x3d,0x13,0x03,0x09,0x23,0x3e,
		0xcb,0x66,0x97,0xea,0x6a,0xf1,0xfa,0xf5,0xed,0xbb,0xe5,0x98,0x17,0x47,0x5d,0x17,
		0x29,0x26,0x03,0x1d,0x32,0x37,0x0a,0x1d,0x29,
		0x36,0xdd,0xd9,0xbe,0x72,0x62,0xdd,0x38,0xaf,0xdf,0x01,0x37,0xb3,0x17,0xcf,0xaf,
		0xeb,0x11,0x01,0x3d,0x12,0x2a,0x0b,0x17,0x13,
		0xa1,0x54,0x1b,0x91,0x79,0xd3,0xc0,0x7b,0x72,0x04,0x1d,0xd6,0x50,0xe7,0x40,0x47,
		0xad,0x3b,0x3f,0x1d,0x31,0x1e,0x0c,0x11,0x3e,
		0x0c,0xcb,0x5d,0x65,0x81,0x44,0xa3,0xbe,0x35,0x29,0x39,0x74,0xec,0xb7,0xb2,0xdf,
		0x70,0x25,0x3d,0x3d,0x10,0x11,0x0d,0x0c,0x29,
		0x77,0x42,0xa0,0x38,0x89,0xb5,0x86,0x01,0xf7,0x4d,0x55,0x13,0x88,0x87,0x23,0x77,
		0x32,0x0f,0x3c,0x1d,0x30,0x05,0x0f,0x06,0x14,
		0xe2,0xb9,0xe2,0x0c,0x91,0x27,0x69,0x45,0xba,0x72,0x71,0xb2,0x25,0x57,0x95,0x0f,
		0xf5,0x39,0x3a,0x3d,0x0f,0x38,0x10,0x00,0x3e,
		0x4d,0x30,0x24,0xe0,0x98,0x98,0x4c,0x88,0x7d,0x97,0x8c,0x51,0xc1,0x27,0x06,0xa7,
		0xb7,0x23,0x38,0x1d,0x2e,0x2c,0x11,0x3a,0x29,
		0xb8,0xa7,0x66,0xb3,0xa0,0x09,0x2f,0xcb,0x3f,0xbb,0xa8,0xf0,0x5d,0xf6,0x78,0x3e,
		0x79,0x0d,0x37,0x3d,0x0d,0x1f,0x12,0x34,0x14,
		0x23,0x1e,0xa8,0x87,0xa8,0x7a,0x12,0x0e,0x02,0xe0,0xc4,0x8f,0xfa,0xc6,0xe9,0xd6,
		0x3c,0x37,0x35,0x1d,0x2d,0x13,0x13,0x2e,0x3e,
		0x8e,0x95,0xea,0x5a,0xb0,0xec,0xf5,0x51,0xc5,0x05,0xe0,0x2e,0x96,0x96,0x5b,0x6e,
		0xfe,0x21,0x33,0x3d,0x0c,0x06,0x14,0x28,0x29,
		0xf9,0x0d,0x2c,0x2e,0xb7,0x5d,0xd8,0x94,0x87,0x29,0xfc,0xcd,0x33,0x66,0xcd,0x06,
		0xc0,0x0b,0x31,0x1d,0x2b,0x3a,0x15,0x22,0x14,
		0x64,0x84,0x6e,0x02,0xbf,0xce,0xbb,0xd7,0x4a,0x4e,0x17,0x6c,0xcf,0x36,0x3e,0x9e,
		0x83,0x35,0x30,0x3d,0x0b,0x2e,0x16,0x1c,0x3e,
		0xcf,0xfb,0xb0,0xd5,0xc7,0x3f,0x9e,0x1a,0x0d,0x73,0x33,0x0a,0x6b,0x06,0xb0,0x36,
		0x45,0x1f,0x2e,0x1e,0x2a,0x21,0x17,0x16,0x29,
		0x3a,0x72,0xf2,0xa9,0xcf,0xb0,0x81,0x5d,0xcf,0x97,0x4f,0xa9,0x08,0xd6,0x21,0xce,
		0x08,0x09,0x2c,0x3e,0x09,0x15,0x18,0x10,0x14,
		0xa5,0xe9,0x34,0x7c,0xd6,0x22,0x64,0xa0,0x92,0xbc,0x6b,0x48,0xa4,0xa5,0x93,0x66,
		0xca,0x33,0x2a,0x1e,0x29,0x08,0x19,0x0a,0x3e,
		0x10,0x60,0x76,0x50,0xde,0x93,0x47,0xe3,0x55,0xe1,0x87,0xe7,0x40,0x75,0x04,0xfe,
		0x8c,0x1d,0x29,0x3e,0x08,0x3c,0x1a,0x04,0x29,
		0x7b,0xd7,0xb8,0x24,0xe6,0x04,0x2a,0x26,0x17,0x06,0xa3,0x86,0xdd,0x45,0x76,0x96,
		0x4f,0x07,0x27,0x1e,0x27,0x2f,0x1b,0x3e,0x14,
		0xe6,0x4e,0xfb,0xf7,0xee,0x75,0x0d,0x69,0xda,0x2a,0xbe,0x25,0x79,0x15,0xe7,0x2e,
		0x11,0x31,0x25,0x3e,0x07,0x23,0x1c,0x38,0x3e,
		0x51,0xc5,0x3d,0xcb,0xf5,0xe6,0xf0,0xac,0x9d,0x4f,0xda,0xc4,0x15,0xe5,0x59,0xc6,
		0xd4,0x1b,0x23,0x1e,0x26,0x16,0x1d,0x32,0x29,
		0xbc,0x3d,0x7f,0x9e,0xfd,0x58,0xd3,0xef,0x5f,0x74,0xf6,0x63,0xb2,0xb5,0xca,0x5e,
		0x96,0x05,0x22,0x3e,0x05,0x0a,0x1e,0x2c,0x14,
		0x27,0xb4,0xc1,0x72,0x05,0xc9,0xb6,0x32,0x22,0x98,0x12,0x02,0x4e,0x85,0x3c,0xf6,
		0x58,0x2f,0x20,0x1e,0x24,0x3d,0x1f,0x26,0x3e,
		0x92,0x2b,0x03,0x45,0x0d,0x3a,0x99,0x75,0xe5,0xbd,0x2e,0xa0,0xeb,0x55,0xad,0x8e,
		0x1b,0x19,0x1e,0x3e,0x04,0x31,0x20,0x20,0x29,
		0xfd,0xa2,0x45,0x19,0x14,0xab,0x7c,0xb8,0xa8,0xe2,0x49,0x3f,0x87,0x24,0x1f,0x26,
		0xdd,0x03,0x1c,0x1e,0x23,0x24,0x21,0x1a,0x14,
		0x68,0x19,0x87,0xed,0x1c,0x1c,0x5f,0xfb,0x6a,0x06,0x65,0xde,0x23,0xf4,0x91,0xbe,
		0xa0,0x2e,0x1b,0x3e,0x02,0x18,0x22,0x14,0x3e,
		0xd3,0x90,0xc9,0xc0,0x24,0x8e,0x42,0x3e,0x2d,0x2b,0x81,0x7d,0xc0,0xc4,0x02,0x56,
		0x62,0x18,0x19,0x1e,0x22,0x0c,0x23,0x0e,0x29,
		0x3e,0x07,0x0b,0x94,0x2c,0xff,0x25,0x81,0xf0,0x50,0x9d,0x1c,0x5c,0x94,0x74,0xee,
		0x24,0x02,0x17,0x3e,0x01,0x3f,0x24,0x08,0x14,
		0xa9,0x7e,0x4d,0x67,0x33,0x70,0x08,0xc4,0xb2,0x74,0xb9,0xbb,0xf8,0x64,0xe5,0x86,
		0xe7,0x2c,0x15,0x1f,0x20,0x33,0x25,0x02,0x3e,
		0x14,0xf5,0x8f,0x3b,0x3b,0xe1,0xeb,0x07,0x75,0x99,0xd4,0x5a,0x95,0x34,0x57,0x1e,
		0xa9,0x16,0x14,0x3f,0x00,0x26,0x26,0x3c,0x29,
	};
	u32 ks_std[KS_LEN * TEST_NUM] =
	{
		0x58d03ad6,0x2e032ce2,0xdafc683a,0x39bdcb03,0x52a2bc67,0xf1b7de74,0x163ce3a1,0x01ef5558,
		0x9639d75b,0x95fa681b,0x7f090df7,0x56391ccc,0x903b7612,0x744d544c,0x17bc3fad,0x8b163b08,
		0x21787c0b,0x97775bb8,0x4943c6bb,0xe8ad8afd,0x7dfcb2b1,0x2bcbc9ab,0xf41bfd2e,0x16c810ff,
		0x8fab11de,0x76a66c67,0x45507cde,0x21f04be0,0x63fd7562,0x6280844e,0xd88d9e5c,0x10048cd9,
		0x3356cbae,0xd1a1c18b,0x6baa4ffe,0x343f777c,0x9e15128f,0x251ab65b,0x949f7b26,0xef7157f2,
		0x96dd2fa9,0xdf95e3ee,0x7a5be02e,0xc32ba585,0x505af316,0xc2f9ded2,0x7cdbd935,0xe441ce11,
		0x15fd0a80,0xbb7aef67,0x68989416,0xb8fac8c2,0x2423a5d5,0x6dee984a,0xe58d6ea7,0xd408bcaa,
		0x93acf481,0x368266d8,0xeddf6ef4,0xd0e0d0e4,0xa7ce33e5,0x95dc3428,0xab82a41b,0xa9f3e26f,
		0x136e21d0,0xbf21b245,0x8a126391,0xd307a828,0xc56322b5,0x9c172357,0xbbb7929b,0xcf5917ce,
		0xa2b57c13,0x91eeab8b,0x2d9b3de3,0xc1456ea5,0x5b1841df,0x1309666f,0x84801e2b,0x35a78424,
		0x671ba804,0x6955573a,0x7001c1c3,0xfcb197fa,0x4f494ced,0x2294a5b9,0x6ad0af68,0x3b429568,
		0x35aa7396,0xf288ee21,0xd2c60784,0xc2a182cf,0xa4672f17,0x313713e9,0xb022f7bf,0xead4b59f,
		0x39df5ad0,0xfff8f074,0x981209cf,0x299d60b0,0xf3a4a3c7,0x2348219d,0x61f69afd,0x44fe464d,
		0x953abdfb,0xf13c0b86,0x6408774b,0x7c303db0,0xd0d666ed,0xf35ae658,0xf424a26a,0xd06ab2bc,
		0x60588d03,0xbe017439,0x2af8297e,0xa968a3f7,0x99c2588e,0xcfcc6abf,0x08aaf397,0xdb0cc18d,
		0xff16c14f,0xfcdf0cd4,0x83fe0149,0x3e19a0db,0x406e94d1,0x81f7270e,0xfa85ef85,0x293535d2,
		0x1747a509,0x6eb83576,0xd31212b2,0x1fb433cf,0x988f7eb2,0xbce70341,0xf52183e5,0xb30e0e14,
		0xb54d89f0,0x4a08347e,0xaacd3ffe,0x61e59d49,0x0f16ab58,0x58ccd317,0xbcd9a5d2,0x299e291d,
		0xec6ede0e,0xba2fa659,0xff76ffd6,0x6543b3e5,0xa1f89b67,0x514699b4,0xc1e854c6,0x0f75dbb3,
		0xd74d971a,0xac84407a,0xb910f683,0xe6659077,0xa23eb25c,0xe935811e,0x1349e8a4,0x9254e414,
		0x903b4f33,0xdc6716a5,0x8dc2dfb1,0xb52b0c07,0xd773994d,0x7838847b,0x5ab3f94e,0xba1514a9,
		0x18669a29,0xf8010dcf,0x103ab12a,0x466e82fa,0x7aba5bea,0x6f5a74b5,0x8018bacc,0x6c875172,
		0xdea9a9ab,0x36f8263b,0x8a941418,0x82a16d05,0x8a45d7d4,0xadc6ba28,0x2e696f64,0xc33061c1,
		0x625cc490,0x147b2d8f,0xe59eca71,0x900f3e38,0x01722b16,0x22575eac,0xd398bd3a,0xe200a145,
		0x3fa55dc8,0x9ba1f1fa,0x7fef53d9,0x5862252b,0x2b61dac6,0xb55ba2dc,0x0637ee5a,0x971ce9c3,
		0xc2fa2d89,0xebfe818b,0x4667ee00,0x12a037d4,0xec6194fa,0x8c744885,0xd613fa42,0xcea4908a,
		0x07151b01,0x69d26183,0xebd652d8,0x0200335b,0xdb0c88b1,0x61c18ee0,0x6d6a183f,0x12a1684c,
		0xcdba0652,0x30661324,0xab74c42c,0x6d72e39f,0x21197cbc,0xd0febc13,0x488c4b43,0x1bca4c06,
		0xaccc9a10,0xa9fde4eb,0x98ae4f5a,0x6d08f4f5,0x6f3fefd6,0xe0f17299,0x391dabb3,0x8b0cd899,
		0x0d51c826,0xd1e2db3c,0x351141f5,0xde23ba93,0x19e0166a,0xce3dbe4d,0xaa3d97ea,0x5c0d4089,
		0x140187d6,0xd7859c74,0x909bde20,0xd0764545,0x6df64e35,0xb6d2d41c,0x515b103b,0x7f57fba9,
		0x60d6c8e3,0x55ce480a,0x14e876d6,0x01c287ca,0xbed6a2b4,0x3607b43c,0x3b116029,0x2b1afd5e,
		0x1eed37da,0xeba5d72b,0xfa56a5d7,0x1168a363,0x79010dca,0x754d5b96,0x58babd60,0x3c530a05,
		0xe80d63d9,0x3a189e85,0x6e491a67,0xe467e0c1,0x717ac85c,0x332b6970,0x7bab2fbd,0x93c9ced1,
		0x3717b23d,0x402ccb1a,0x2fd27e29,0x55d29293,0x9b093a88,0xc982d941,0xc4b9d89e,0x9ca8cc5b,
		0x7f41285b,0x36bb22ed,0x547e3884,0x9836e3b0,0x471a820e,0xbf035fb2,0x5439fd71,0xd30743d7,
		0xa51de114,0x41cb4e70,0x16e22149,0x02a3496f,0xb1e21130,0xcf755ff8,0x579be05d,0x7ae871ae,
		0x514ed216,0x39578540,0x628f5031,0xd029d404,0x490a8cc8,0x893e4578,0x21fe7654,0x841c5c36,
		0x43b785d8,0x9bc721f0,0xeff5c4e4,0x5b9ea145,0xa27589df,0x8079a392,0x51b1b5ac,0x8c6e38f7,
		0x337d66c9,0x0fc562d7,0x714ab9c0,0xbc51f48f,0xdeae22be,0x6ec9cd6d,0xa2ae4ba6,0x53e325ad,
		0xc2857531,0x252ebed7,0x88014ff4,0x7ffc2e28,0x09ea64ca,0x6bdf989f,0x4be00330,0xf4588c7f,
		0x8f51483b,0x19084286,0x3cfd9875,0x07f36e9e,0x3b5bfc41,0xd5063b66,0xf44a8652,0x497a9898,
		0xdafea615,0xa86a66ff,0xf45d3369,0x01fae1ac,0x9b94301a,0x4dc997a4,0xf3b44195,0x61e094fc,
		0x2077d4bc,0xf599e147,0x581267bf,0x843282c0,0xe049b522,0xfb90014d,0xd68ad46e,0xfe6572f6,
		0xaa8645b7,0x6e06c7a5,0x376d59d0,0x01dbce19,0xb89a1407,0x7fbb0cbb,0xb008b8e8,0xf023a44a,
		0xf5ac732c,0x2e897ba9,0x14a3f122,0x303d44f0,0x2a2a7844,0x89991bf1,0xad01eb52,0xea276828,
		0x1371d6a6,0x117340c5,0xc64b40a6,0xe4a3ea54,0x9e3d8643,0xb15ca01a,0x86a082bd,0x81ee94f0,
		0x2b7b7be8,0xb9c229c7,0x3608c62d,0x29151b05,0x68559634,0x1ce61b69,0xa77c6442,0x7131acdf,
		0x23deb828,0x7a70427e,0xdf9431ca,0xee1f83d8,0xf0b2116b,0x16964bad,0x99cd26ca,0xd320cc84,
		0x98576df5,0x8a5430d4,0x73695f9c,0x141c931b,0xa1c1285c,0xf59aebeb,0x7851b397,0x7b610c41,
		0xf4b67d7e,0xdeea1a43,0x246ce1dd,0x47447e73,0xa66fdbe3,0x8a609c3c,0xaf061299,0x36a986ae,
		0x1adbb693,0xcbee2b97,0x9eca8741,0xeaee4c15,0xbc19e671,0x0e302281,0x9e0c93a7,0xd62ff87d,
		0x64d655ae,0xd4bbdc95,0x542e04c5,0x77d77f38,0xa6e51c19,0xa85098f8,0x61dc86ff,0x3672a082,
		0xb8262c5b,0x46b544d1,0x13cc92c9,0x3b44e8e6,0xf6ffd16c,0x1c0dacfa,0x856315da,0x34f47a90,
		0x152c8020,0x8fbc7161,0x8cc62f1c,0xae945dcc,0x54b9ebba,0x4ae6322b,0x5cec8a5b,0x6f597026,
		0x06060b3e,0x708e9011,0xfeed012a,0x2bb80924,0x04d28f8b,0x8c18c870,0x53305e95,0xc8a34ca6,
		0xece4a605,0x1cbcbb03,0x76f67654,0xc756c70f,0xcb16301f,0x036b6d8b,0x2a5264ae,0x1c65c9c1,
		0x1ac24137,0xbe4d19ee,0x89085a78,0xafb52de4,0xfb60c574,0xfd7cf94a,0x6950ba37,0xd46ca763,
		0xd5a5f347,0xf3632ad3,0x12eb586a,0x79ee7e1c,0xcbf3ceb2,0xfb68a53b,0x517493f0,0x5af980d5,
		0x63297def,0x363e33d2,0xd86f4ef9,0xe7865479,0xe7099f95,0xbbfc4e95,0xefbbf3b1,0xdd7eeadd,
		0x0f6bdb96,0xc387e915,0x3aa17cbc,0x116a70fd,0x90dff352,0x02835270,0xff17eaaa,0x682b4036,
		0xc0e24366,0xb45d3007,0x42735033,0x231cd593,0xca35c58f,0xebe62753,0x28c8ad1d,0xf31a83d1,
		0xac41068c,0xc2c9f881,0x0c425729,0x92c22e30,0x414a1760,0x7bbdcc35,0x42ddbfe6,0x373e980c,
		0xbb1a66e1,0x100a5e2e,0x04a9fcf5,0x7d2e1419,0xf4d21ffb,0x3d1531ae,0xdcd2fa8b,0x3e6d05e2,
		0xdb43820d,0x682b2958,0xdc439982,0xf8f33451,0x3369507b,0xbc2c21fd,0x2eba729b,0x30a7bc7e,
		0xa6e9269b,0xa6d7cd64,0xd27b87a8,0x642cea32,0xbfd928ad,0x70f34ed8,0xaab5421e,0x6d4c4ca7,
		0x50368205,0xff8eabc7,0xeb1d7338,0xa2cb2731,0xa496e4fc,0xfa0ad1c6,0x62d2dc8b,0x7efee86f,
		0xbb71039a,0x386407cf,0x95b58aa9,0xc9872bfd,0x78b66ce8,0x5de3988f,0x44351376,0xdd85a6e6,
		0x5a1055e9,0xc2decb97,0x8bac7016,0x65269b70,0xc68aef0e,0x9fe337f1,0x31e40676,0x865b74ac,
		0xe4bfad8d,0xe5cbb02a,0x5547ea17,0xcaee10b6,0xfbdfbd7e,0xa867ef09,0xfd19b308,0xf55b8b49,
		0x7073e9f9,0xa7cbdbfa,0xd15ffbcf,0x01bddc70,0xb3c7805c,0xf21060d9,0x3258fb83,0x13dc4f1a,
		0xa5515169,0x095ee1b2,0x64dde6f6,0x1c75526a,0x9a8e95ce,0xbb4f696f,0x61df87b8,0x41066ba5,
		0x08dec40a,0x435a7f2d,0x6f68fe2a,0x240a8aec,0x816cb5b7,0xda710307,0x8215b5d4,0x6a892277,
		0xc640edab,0x7bae5115,0x5f03326f,0x59a7dd54,0x6144e89e,0x1c56d48e,0x1d8210ba,0xf3f41833,
		0x9e51ede6,0x06c9037c,0x20eda1fd,0x37505a2c,0x3c2749de,0x2fe1d053,0x3afece91,0xdecbc4ff,
		0xff4ca8f4,0x460b05af,0x8e36085b,0xfc9eaeeb,0xe5777b80,0x438835aa,0x5b5e3da9,0x86f68977,
		0x37f7298b,0xa3efb010,0xe1d2517b,0xd1284355,0x2ef28c03,0x1cf91841,0x1cdb8a41,0x8d1ca8f3,
		0x9dcf3a45,0xf99d229e,0x7e8cd838,0xe5a5f00c,0xd566a07e,0x4dfe22db,0xe2a29c9f,0x51f6543a,
		0x8a5a7bd9,0x44ed42f4,0x5d648b1f,0xed72ed68,0xe2c1423d,0xf64d0efb,0x1c4d56b8,0xa564deb7,
		0xc4bd0f6a,0x0abf1246,0x487e109e,0xac3199af,0x3bf52331,0xdf2462db,0xc0ae8c16,0xa7799409,
		0x615c4f79,0x3cebd624,0xeade2f9f,0xc5f1861e,0xe63fecda,0x91dc2f4e,0x6d4aadb2,0xc6beef4d,
		0x5ba8f734,0xa0dd24ff,0xd4512b1e,0x438a1ab2,0x2d133202,0x7b233c29,0xdc3209f0,0x7d457849,
		0xad1ed12b,0x0d112a31,0xd916097f,0xa5e74878,0x9df7eaa7,0x4d28667f,0x760f34b8,0xb9ebdfe6,
		0x7bc6c660,0x0a92620f,0xb059dca3,0x897e4ace,0x3ed499d9,0xe6b89342,0x9abc7166,0xbc7968be,
		0x0b34b221,0x27be2497,0x07d93227,0x0fee1fe6,0x6cbb5d82,0x9556565b,0xc834402b,0x6a745ec7,
		0xe4055419,0x4c149160,0xa1fb6d07,0xe673b7fb,0x7bfb365e,0xc2fb39ac,0x129874db,0xd1e9ea52,
		0x7a6e72a6,0xca5c8ea8,0x0d5aa7be,0x56fafc45,0xc58003a7,0xe9aad1b9,0x6d16dafe,0x1baf2b67,
		0x36381f60,0x20b8311b,0x559c4021,0x9676c4f6,0x863e9292,0xd3941a40,0x2e6d11cc,0x331cf874,
		0x1efdf682,0x93684d11,0x913a577f,0x9a43d449,0x50fb44d6,0xe58d10c5,0x9b98338d,0xf0dd99fd,
		0x5ac2db13,0xa8e142a7,0x5286b1ea,0xd73a5619,0x03944a36,0x2ac2567d,0x5df13817,0xc2b5bfdb,
		0x4298d9d9,0x826e9557,0xe905eb4f,0xc0c2cf63,0x3038f2a4,0xaffd993f,0x6a1b498c,0xd05d2adf,
		0xdadbb0d0,0xcefdae9a,0xaae009a2,0xe45738aa,0xf91d07e5,0x311624fa,0xd0865242,0xc004ca66,
		0x7d653dc1,0x96a65e44,0x55c8a19f,0x49d503d6,0xe46bf3b6,0x9494862d,0xc4d55595,0x3adb245f,
		0x3c9aeb83,0x0e137845,0x10158886,0xd1f0da24,0x9b6c74d3,0x71986405,0xd94cb849,0x42a95a79,
		0x41f16bd5,0xa3520d09,0x85a889f3,0x2dbf3e03,0xc5f7ec78,0x8619d30e,0xbb9a9b6f,0x65bae035,
		0xa20c923b,0xf8953416,0xc37a6e82,0x1fd3974b,0x4a7dc0ca,0x52e6d1fd,0xdd79dd83,0x4bdba763,
		0xeb28614b,0x9631692f,0x1493d2af,0xcbdffdf5,0x6fa30518,0xc9e02348,0x54438367,0x85daf3a3,
		0xc46b8318,0x4595a215,0x006ed047,0x42d63dae,0xe29febfe,0x442b1c24,0x4624732d,0x0add6c34,
		0x5cb59742,0x6c4f0f09,0xdd51ce25,0xcaee2876,0x2ef6c526,0xd0e839f6,0x1c0faf4e,0xfc42c083,
		0x03677f34,0xf5dd06a8,0x06d458bb,0x82f797f5,0x768c3d12,0x2bf02a07,0x5895ecec,0xb5cbb513,
		0x15c94edd,0xace9de70,0x422f2346,0xddfb4d71,0xfd847aba,0xec09e949,0x4003c0c2,0xd7a49b8f,
		0x561bc47e,0xe1df5606,0x7107f10a,0xaa7d2498,0x35961609,0x651457ee,0xa6c7f761,0xdf1f2d25,
		0xf459a7a8,0xfee3ad07,0xcd908c46,0x5b4d9e80,0x637b55f2,0x858b7f18,0x464cd333,0xbb7e0b71,
		0x67e13001,0xad765e3c,0xa2ce1bab,0x5866e98b,0x3a622f78,0x077776d7,0x2157cb8f,0xcec355e2,
		0x306a7787,0x0055f599,0x3ba1824d,0x17236b89,0xb7d4206a,0x60772e9e,0x77f16848,0xa7d5d036,
		0x1d53ffee,0x3db7d4fd,0x4991c542,0xae4e29f9,0x10e89146,0x90b4d40a,0x635dfacf,0xfa8c2b98,
		0x2eb5af33,0xa8b089b9,0x80e65a14,0x1d26648c,0x29792dfe,0x7c9a43f0,0xcefbfb08,0x22c4ef4a,
		0x81a52182,0x3e6d7c1e,0xfdf2361f,0xa3c74046,0x72df4eb5,0x824c1df9,0xd1540f13,0x2d6237c5,
		0xe27987f3,0x140d66d2,0xce829f39,0x0a8d8196,0x45803e3f,0x50b5f50b,0x5b9ed495,0x34d12e80,
		0x2b67c22d,0x737a473a,0xd80d76c4,0xe5aaa6ce,0x0600404f,0xe47afca8,0x415e4422,0xfd2ad5c7,
		0x98ccdcdb,0x67defa6b,0x4d7977af,0x406b38c6,0x0ced19d2,0x1a84ab81,0xc93e66f5,0x3027d085,
		0x5e9c39ca,0x221a45e3,0x213111d0,0x260f1c71,0xd6f4664b,0x09bbe6b3,0xbccca141,0x7a9ac44d,
		0x1cc02e2f,0xe57faba9,0x0a4022b4,0x44ccac99,0xd3d08a89,0xf9163ed3,0xcdb6f7d6,0x1d69f45b,
		0x66b182f1,0x19a2a1b0,0xdba915b7,0x1087d5ac,0xc823f3a0,0xe6afb55d,0x67bcf467,0x9f2f209d,
		0x7c25144e,0x61234656,0xdbeeb37e,0x98bbd31d,0xc3419efb,0xd5a255a3,0xaaf66298,0x5c034d0b,
		0x039c4fdf,0x533e43dc,0x73ee37fc,0x3d1ed69b,0xd01ab86b,0xbd14d056,0xd85f3443,0x376b4738,
		0x93bfc498,0x4435077f,0x665bb206,0x8d9a3812,0x46b30723,0x58b4398f,0xebc6680e,0xe3ca5ede,
		0x997e02f8,0x3afb0cbd,0xc9e24104,0x686e4766,0x5386255b,0xdaa708fc,0x48ff3d5b,0xe2fdd99a,
		0x2555d72c,0x2778ad33,0xca6ad499,0x8a7c93ec,0xb79f1e42,0x6eaa4a89,0xc10d4eb5,0x22b536b5,
		0x3dce9407,0x27a0d10d,0xb376efab,0xe0317e88,0xedd43962,0x98886d0e,0x75edb2c5,0x7e622a67,
		0x665da8f2,0xc5b33f69,0x7c20dc04,0x4cba1057,0xb6ca61f5,0x53329d32,0xc817800a,0x28af6fab,
		0x936d7aac,0x8e2a2eae,0xbda248b0,0xe011d8e8,0x1de22af6,0xd5cd53d6,0x8b0d53ec,0x42a2e249,
		0xac2ce137,0x29349359,0x079bcb01,0xbf0e53db,0xb54b5507,0xe16eee7e,0x914a159f,0x6fd94a2d,
		0xd50c13db,0xecfee9f9,0xb36f45cc,0x779cfffc,0xc0d1205d,0x8f40a8d8,0x9ee43613,0xb85e234b,
		0x055e20c0,0xd99d063d,0xf90d21d4,0x3e57c597,0x117c1089,0xc5870296,0x41dd6e10,0xeb73ab10,
		0xba8c3162,0xac5a91a4,0xadcc169a,0x34d4186c,0xf990d8aa,0x6e7953c4,0x261d1df1,0xcef5f3c8,
		0x93a88d8f,0x903ba850,0x90e02df8,0x8330d11f,0xb7d3efbe,0xf944912f,0xa6619da3,0x1367bcc9,
		0x9a895edd,0x63b207d1,0x68fb348b,0x442798fb,0xafd03d95,0x9445a8ba,0x8f0b86f6,0x7a4ac561,
		0xe96328bd,0x6f68493a,0x1c6d8602,0xfe09fcd1,0x7a7b35f0,0x340526bd,0xd4cb4e29,0xc9e26137,
		0xfc9cea44,0x42047ab6,0xc4ca18cf,0x4070d9bb,0xb2bee9cf,0x08209efc,0xa456a10e,0xc10a82cf,
		0x92059697,0x7e586161,0xde61dc9b,0xeea8e972,0xa207f5d4,0x285cd508,0x57e8ebc1,0xcb441fab,
		0x5988ea89,0x6d1213a1,0x3639708e,0xe7e48a71,0xc747d85e,0x942b4c2f,0x5a46b15f,0x0ff6e494,
	};//standard datas

	u32 ks[KS_LEN * PARALLEL_NUM];
	u32 msg[KS_LEN * PARALLEL_NUM];
	int i, j, k;

	///////////////////////////////////////////////////
	for (i = 0; i < TEST_NUM - PARALLEL_NUM; i++)
	{
		ZUC256_AVX512(ks, KS_LEN, k_std + i * KEY_LEN, iv_std + i * IV_LEN);
		printf("\n Test ZUC256_AVX512 %d is ", i);

		for (k = 0; k < PARALLEL_NUM; k++)
		{
			for (j = 0; j < KS_LEN; j++)
			{
				if (ks[PARALLEL_NUM*j + k] != ks_std[KS_LEN*(i + k) + j])
				{
					printf("%d, error!\n",k); exit(0);
				}
			}
		}
		printf("right");
	}
	printf("\n"); 

	///////////////////////////////////////////////////	
	for (i = 0; i < TEST_NUM - PARALLEL_NUM; i++)
	{
		for (j = 0; j < KS_LEN * PARALLEL_NUM; j++) msg[j] = j;
		ZUC256_CRYPT_AVX512(msg, k_std + i * KEY_LEN, iv_std + i * IV_LEN, msg, KS_LEN);
		for (j = 0; j < KS_LEN * PARALLEL_NUM; j++) msg[j] ^= j;

		printf("\n Test ZUC256_CRYPT_AVX512 %d is ", i);
		for (j = 0; j < KS_LEN; j++)
		{
			for (k = 0; k < PARALLEL_NUM; k++)
			{
				if (msg[PARALLEL_NUM*j + k] != ks_std[KS_LEN*(i + k) + j])
				{
					printf("error!\n"); exit(0);
				}
			}
		}
		printf("right");
	}
	printf("\n");
	///////////////////////////////////////////////////	
}


void ZUC256_SpeedTest_AVX512()
{
	totalspeed = 0;
	FILE *fp = NULL, *fptxt = stdout, *fpscreen = stdout;
	double start, finish, totaltime, speed, evenspeed[3] = { 0 };
	int TIMES, i, j, mode, fpfile, NUMBERS;
	u32 msg[MAXBYTELEN * PARALLEL_NUM / 4];
	u8 *k = (u8*)msg;
	u8 *iv = (u8*)(msg + 8);
	u32 wordlen, NNN;

#if(TOTXTFILE==1)
	char SpeedFileName[] = "ZUC256_AVX512_LINE_16_Speed_XXXXXXXX.txt";
	const char hex[16] = { 'A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P' };
	int maze;
	{
		maze = (int)time(0);
		for (i = 0; i < 8; i++)
			SpeedFileName[strlen(SpeedFileName) - 5 - i] = hex[((maze >> (4 * i)) & 0xf)];
		fopen_s(&fptxt, SpeedFileName, "w+");
	}
#endif

	//#####################################################//
	NUMBERS = 10;
	for (j = 0; j < NUMBERS; j++)
	{
		memset(msg, 0xab, MAXBYTELEN * PARALLEL_NUM);
		///////////////////////////////////////////////////////////
		for (mode = 2; mode < 3; mode++)
		{
			switch (mode)
			{
			case 0: NNN = 20;	wordlen = 256 / sizeof(u32);	break; // short message
			case 1: NNN = 19;	wordlen = 2048 / sizeof(u32);	break; // middle message
			case 2: NNN = 16;	wordlen = 9000 / sizeof(u32);	break; // long message
			}
			TIMES = 1 << NNN;
			start = clock();
			for (i = 0; i < TIMES; i++)
			{
				//ZUC256_CRYPT_AVX512(msg, k, iv, msg, wordlen);
				ZUC256_AVX512(msg, wordlen, k, iv);
			}
			finish = clock();
			totaltime = (finish - start) / CLOCKS_PER_SEC;
			speed = (((double)wordlen * 32 * PARALLEL_NUM) / 1000.0)*((double)TIMES / 1000.0) / totaltime;
			evenspeed[mode] += speed;
			fpfile = 0;
#if(TOTXTFILE==1)
			for (; fpfile < 2; fpfile++)
#endif
			{
				switch (fpfile)
				{
				case 0: fp = fpscreen; break;
				case 1: fp = fptxt; break;
				}
				fprintf(fp, "\n\n ZUC256_AVX512_LINE_%d : one line generate %d bytes keystream", PARALLEL_NUM, wordlen * (int)sizeof(u32));
				fprintf(fp, "\n Test Function\t ZUC256_CRYPT_AVX512");
				fprintf(fp, "\n Test Times\t 1<<%d", NNN);
				fprintf(fp, "\n Test Time\t %.3f seconds", totaltime);
				fprintf(fp, "\n Test Speed\t %.2f Gbps", speed/1000.0);
			}
		}
		///////////////////////////////////////////////////////////
		fprintf(fpscreen, "\n\n\n");
		fprintf(fptxt, "\n\n\n");
	}
	//#####################################################//
	printf("\n\n test times = %d, max even speed is %.2f Gbps\n\n", NUMBERS, evenspeed[2] / NUMBERS /1000.0);
	totalspeed += evenspeed[2] / NUMBERS;
#if(TOTXTFILE==1)
	fclose(fptxt);
#endif
}

///////////////////////////////////////////////////////////////////////////////////////////////////////
void ZUC256_MAC_SelfTest_AVX512()
{
	u8 k0_std[32 * 16] = { 0 }, iv0_std[25 * 16] = { 0 };
	u8 k1_std[32 * 16];
	u32 msg0_std[13 * 16] = { 0 }, msg1_std[125 * 16];
	
	memset(k1_std, 0xff, 32 * 16); 
	memset(msg1_std, 0x11, 125 * 16 * 4);

	u8 iv1_std[25 * 16] =
	{
		0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
		0xff,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
		0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
		0xff,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
		0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
		0xff,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
		0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
		0xff,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
		0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
		0xff,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
		0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
		0xff,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
		0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
		0xff,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
		0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
		0xff,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
		0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
		0xff,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
		0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
		0xff,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
		0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
		0xff,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
		0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
		0xff,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
		0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
		0xff,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
		0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
		0xff,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
		0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
		0xff,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
		0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
		0xff,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f
	};

	//standard datas
	u32 mac32_std00[16] = { 0x61d379b8,0x61d379b8,0x61d379b8,0x61d379b8,0x61d379b8,0x61d379b8,0x61d379b8,0x61d379b8,
	0x61d379b8,0x61d379b8,0x61d379b8,0x61d379b8,0x61d379b8,0x61d379b8,0x61d379b8,0x61d379b8 };
	u32 mac64_std00[32] = { 0x21e08e06,0x21e08e06,0x21e08e06,0x21e08e06,0x21e08e06,0x21e08e06,0x21e08e06,0x21e08e06,
		0x21e08e06,0x21e08e06,0x21e08e06,0x21e08e06,0x21e08e06,0x21e08e06,0x21e08e06,0x21e08e06,
		0x741f8e08,0x741f8e08,0x741f8e08,0x741f8e08,0x741f8e08,0x741f8e08,0x741f8e08,0x741f8e08,
		0x741f8e08,0x741f8e08,0x741f8e08,0x741f8e08,0x741f8e08,0x741f8e08,0x741f8e08,0x741f8e08};
	u32 mac128_std00[64] = { 0xf5e2415d,0xf5e2415d,0xf5e2415d,0xf5e2415d,0xf5e2415d,0xf5e2415d,0xf5e2415d,0xf5e2415d,
		0xf5e2415d,0xf5e2415d,0xf5e2415d,0xf5e2415d,0xf5e2415d,0xf5e2415d,0xf5e2415d,0xf5e2415d,
		0xa4868d77,0xa4868d77,0xa4868d77,0xa4868d77,0xa4868d77,0xa4868d77,0xa4868d77,0xa4868d77,
		0xa4868d77,0xa4868d77,0xa4868d77,0xa4868d77,0xa4868d77,0xa4868d77,0xa4868d77,0xa4868d77,
		0x2657fd71,0x2657fd71,0x2657fd71,0x2657fd71,0x2657fd71,0x2657fd71,0x2657fd71,0x2657fd71,
		0x2657fd71,0x2657fd71,0x2657fd71,0x2657fd71,0x2657fd71,0x2657fd71,0x2657fd71,0x2657fd71,
		0xb33a4e32,0xb33a4e32,0xb33a4e32,0xb33a4e32,0xb33a4e32,0xb33a4e32,0xb33a4e32,0xb33a4e32,
		0xb33a4e32,0xb33a4e32,0xb33a4e32,0xb33a4e32,0xb33a4e32,0xb33a4e32,0xb33a4e32,0xb33a4e32};

	u32 mac32_std01[16] = { 0x8754f5cf,0x8754f5cf,0x8754f5cf,0x8754f5cf,0x8754f5cf,0x8754f5cf,0x8754f5cf,0x8754f5cf,
	0x8754f5cf,0x8754f5cf,0x8754f5cf,0x8754f5cf,0x8754f5cf,0x8754f5cf,0x8754f5cf,0x8754f5cf };
	u32 mac64_std01[32] = { 0x130dc225,0x130dc225,0x130dc225,0x130dc225,0x130dc225,0x130dc225,0x130dc225,0x130dc225,
		0x130dc225,0x130dc225,0x130dc225,0x130dc225,0x130dc225,0x130dc225,0x130dc225,0x130dc225,
		0xe72240cc,0xe72240cc,0xe72240cc,0xe72240cc,0xe72240cc,0xe72240cc,0xe72240cc,0xe72240cc,
		0xe72240cc,0xe72240cc,0xe72240cc,0xe72240cc,0xe72240cc,0xe72240cc,0xe72240cc,0xe72240cc };
	u32 mac128_std01[64] = { 0xdf1e8307,0xdf1e8307,0xdf1e8307,0xdf1e8307,0xdf1e8307,0xdf1e8307,0xdf1e8307,0xdf1e8307,
		0xdf1e8307,0xdf1e8307,0xdf1e8307,0xdf1e8307,0xdf1e8307,0xdf1e8307,0xdf1e8307,0xdf1e8307,
		0xb31cc62b,0xb31cc62b,0xb31cc62b,0xb31cc62b,0xb31cc62b,0xb31cc62b,0xb31cc62b,0xb31cc62b,
		0xb31cc62b,0xb31cc62b,0xb31cc62b,0xb31cc62b,0xb31cc62b,0xb31cc62b,0xb31cc62b,0xb31cc62b,
		0xeca1ac6f,0xeca1ac6f,0xeca1ac6f,0xeca1ac6f,0xeca1ac6f,0xeca1ac6f,0xeca1ac6f,0xeca1ac6f,
		0xeca1ac6f,0xeca1ac6f,0xeca1ac6f,0xeca1ac6f,0xeca1ac6f,0xeca1ac6f,0xeca1ac6f,0xeca1ac6f,
		0x8190c22f,0x8190c22f,0x8190c22f,0x8190c22f,0x8190c22f,0x8190c22f,0x8190c22f,0x8190c22f,
		0x8190c22f,0x8190c22f,0x8190c22f,0x8190c22f,0x8190c22f,0x8190c22f,0x8190c22f,0x8190c22f};

	u32 mac32_std10[16] = { 0x0981a776,0x0981a776,0x0981a776,0x0981a776,0x0981a776,0x0981a776,0x0981a776,0x0981a776,
	0x0981a776,0x0981a776,0x0981a776,0x0981a776,0x0981a776,0x0981a776,0x0981a776,0x0981a776 };
	u32 mac64_std10[32] = { 0xb7a339c0,0xb7a339c0,0xb7a339c0,0xb7a339c0,0xb7a339c0,0xb7a339c0,0xb7a339c0,0xb7a339c0,
		0xb7a339c0,0xb7a339c0,0xb7a339c0,0xb7a339c0,0xb7a339c0,0xb7a339c0,0xb7a339c0,0xb7a339c0,
		0x6e36fcb3,0x6e36fcb3,0x6e36fcb3,0x6e36fcb3,0x6e36fcb3,0x6e36fcb3,0x6e36fcb3,0x6e36fcb3,
		0x6e36fcb3,0x6e36fcb3,0x6e36fcb3,0x6e36fcb3,0x6e36fcb3,0x6e36fcb3,0x6e36fcb3,0x6e36fcb3 };
	u32 mac128_std10[64] = { 0x889e3823,0x889e3823,0x889e3823,0x889e3823,0x889e3823,0x889e3823,0x889e3823,0x889e3823,
		0x889e3823,0x889e3823,0x889e3823,0x889e3823,0x889e3823,0x889e3823,0x889e3823,0x889e3823,
		0xbef96e2b,0xbef96e2b,0xbef96e2b,0xbef96e2b,0xbef96e2b,0xbef96e2b,0xbef96e2b,0xbef96e2b,
		0xbef96e2b,0xbef96e2b,0xbef96e2b,0xbef96e2b,0xbef96e2b,0xbef96e2b,0xbef96e2b,0xbef96e2b,
		0xc887ec99,0xc887ec99,0xc887ec99,0xc887ec99,0xc887ec99,0xc887ec99,0xc887ec99,0xc887ec99,
		0xc887ec99,0xc887ec99,0xc887ec99,0xc887ec99,0xc887ec99,0xc887ec99,0xc887ec99,0xc887ec99,
		0x0a01b391,0x0a01b391,0x0a01b391,0x0a01b391,0x0a01b391,0x0a01b391,0x0a01b391,0x0a01b391,
		0x0a01b391,0x0a01b391,0x0a01b391,0x0a01b391,0x0a01b391,0x0a01b391,0x0a01b391,0x0a01b391};

	u32 mac32_std11[16] = { 0x5c7c8b88,0x5c7c8b88,0x5c7c8b88,0x5c7c8b88,0x5c7c8b88,0x5c7c8b88,0x5c7c8b88,0x5c7c8b88,
	0x5c7c8b88,0x5c7c8b88,0x5c7c8b88,0x5c7c8b88,0x5c7c8b88,0x5c7c8b88,0x5c7c8b88,0x5c7c8b88 };
	u32 mac64_std11[32] = { 0xea1dee54,0xea1dee54,0xea1dee54,0xea1dee54,0xea1dee54,0xea1dee54,0xea1dee54,0xea1dee54,
		0xea1dee54,0xea1dee54,0xea1dee54,0xea1dee54,0xea1dee54,0xea1dee54,0xea1dee54,0xea1dee54,
		0x4bb6223b,0x4bb6223b,0x4bb6223b,0x4bb6223b,0x4bb6223b,0x4bb6223b,0x4bb6223b,0x4bb6223b,
		0x4bb6223b,0x4bb6223b,0x4bb6223b,0x4bb6223b,0x4bb6223b,0x4bb6223b,0x4bb6223b,0x4bb6223b };
	u32 mac128_std11[64] = { 0x3a83b554,0x3a83b554,0x3a83b554,0x3a83b554,0x3a83b554,0x3a83b554,0x3a83b554,0x3a83b554,
		0x3a83b554,0x3a83b554,0x3a83b554,0x3a83b554,0x3a83b554,0x3a83b554,0x3a83b554,0x3a83b554,
		0xbe408ca5,0xbe408ca5,0xbe408ca5,0xbe408ca5,0xbe408ca5,0xbe408ca5,0xbe408ca5,0xbe408ca5,
		0xbe408ca5,0xbe408ca5,0xbe408ca5,0xbe408ca5,0xbe408ca5,0xbe408ca5,0xbe408ca5,0xbe408ca5,
		0x494124ed,0x494124ed,0x494124ed,0x494124ed,0x494124ed,0x494124ed,0x494124ed,0x494124ed,
		0x494124ed,0x494124ed,0x494124ed,0x494124ed,0x494124ed,0x494124ed,0x494124ed,0x494124ed,
		0x9d473205,0x9d473205,0x9d473205,0x9d473205,0x9d473205,0x9d473205,0x9d473205,0x9d473205,
		0x9d473205,0x9d473205,0x9d473205,0x9d473205,0x9d473205,0x9d473205,0x9d473205,0x9d473205 };//��׼����

	u32 msg0_len = 13, msg1_len = 125;
	u32 mac32[PARALLEL_NUM], mac64[2*PARALLEL_NUM], mac128[4*PARALLEL_NUM];
	///////////////////////////////////////////////////

	ZUC256_MAC_AVX512(mac32, 32, k0_std, iv0_std, msg0_std, msg0_len);
	printf("First Test ZUC256_MAC32_AVX512 is ");
	if (memcmp(mac32, mac32_std00, PARALLEL_NUM) != 0)
	{
		printf("ERROR!\n"); exit(0);
	}
	printf("RIGHT!\n");
	ZUC256_MAC_AVX512(mac64, 64, k0_std, iv0_std, msg0_std, msg0_len);
	printf("First Test ZUC256_MAC64_AVX512 is ");
	if (memcmp(mac64, mac64_std00, 2*PARALLEL_NUM) != 0)
	{
		printf("ERROR!\n"); exit(0);
	}
	printf("RIGHT!\n");
	ZUC256_MAC_AVX512(mac128, 128, k0_std, iv0_std, msg0_std, msg0_len);
	printf("First Test ZUC256_MAC128_AVX512 is ");
	if (memcmp(mac128, mac128_std00, 4 * PARALLEL_NUM) != 0)
	{
		printf("ERROR!\n"); exit(0);
	}
	printf("RIGHT!\n\n");
	
	ZUC256_MAC_AVX512(mac32, 32, k0_std, iv0_std, msg1_std, msg1_len);
	printf("Second Test ZUC256_MAC32_AVX512 is ");
	if (memcmp(mac32, mac32_std01, PARALLEL_NUM) != 0)
	{
		printf("ERROR!\n"); exit(0);
	}
	printf("RIGHT!\n");
	ZUC256_MAC_AVX512(mac64, 64, k0_std, iv0_std, msg1_std, msg1_len);
	printf("Second Test ZUC256_MAC64_AVX512 is ");
	if (memcmp(mac64, mac64_std01, 2 * PARALLEL_NUM) != 0)
	{
		printf("ERROR!\n"); exit(0);
	}
	printf("RIGHT!\n");
	ZUC256_MAC_AVX512(mac128, 128, k0_std, iv0_std, msg1_std, msg1_len);
	printf("Second Test ZUC256_MAC128_AVX512 is ");
	if (memcmp(mac128, mac128_std01, 4 * PARALLEL_NUM) != 0)
	{
		printf("ERROR!\n"); exit(0);
	}
	printf("RIGHT!\n\n");

	ZUC256_MAC_AVX512(mac32, 32, k1_std, iv1_std, msg0_std, msg0_len);
	printf("Third Test ZUC256_MAC32_AVX512 is ");
	if (memcmp(mac32, mac32_std10, PARALLEL_NUM) != 0)
	{
		printf("ERROR!\n"); exit(0);
	}
	printf("RIGHT!\n");
	ZUC256_MAC_AVX512(mac64, 64, k1_std, iv1_std, msg0_std, msg0_len);
	printf("Third Test ZUC256_MAC64_AVX512 is ");
	if (memcmp(mac64, mac64_std10, 2 * PARALLEL_NUM) != 0)
	{
		printf("ERROR!\n"); exit(0);
	}
	printf("RIGHT!\n");
	ZUC256_MAC_AVX512(mac128, 128, k1_std, iv1_std, msg0_std, msg0_len);
	printf("Third Test ZUC256_MAC128_AVX512 is ");
	if (memcmp(mac128, mac128_std10, 4 * PARALLEL_NUM) != 0)
	{
		printf("ERROR!\n"); exit(0);
	}
	printf("RIGHT!\n\n");

	ZUC256_MAC_AVX512(mac32, 32, k1_std, iv1_std, msg1_std, msg1_len);
	printf("Fourth Test ZUC256_MAC32_AVX512 is ");
	if (memcmp(mac32, mac32_std11, PARALLEL_NUM) != 0)
	{
		printf("ERROR!\n"); exit(0);
	}
	printf("RIGHT!\n");
	ZUC256_MAC_AVX512(mac64, 64, k1_std, iv1_std, msg1_std, msg1_len);
	printf("Fourth Test ZUC256_MAC64_AVX512 is ");
	if (memcmp(mac64, mac64_std11, 2 * PARALLEL_NUM) != 0)
	{
		printf("ERROR!\n"); exit(0);
	}
	printf("RIGHT!\n");
	ZUC256_MAC_AVX512(mac128, 128, k1_std, iv1_std, msg1_std, msg1_len);
	printf("Fourth Test ZUC256_MAC128_AVX512 is ");
	if (memcmp(mac128, mac128_std11, 4 * PARALLEL_NUM) != 0)
	{
		printf("ERROR!\n"); exit(0);
	}
	printf("RIGHT!\n\n");
	///////////////////////////////////////////////////	
}




void ZUC256_MAC_SpeedTest_AVX512()
{
#define MAC_BITLENGTH 32
	totalspeed = 0;
	FILE *fp = NULL, *fptxt = stdout, *fpscreen = stdout;
	double start, finish, totaltime, speed, evenspeed[3] = { 0 };
	int TIMES, i, j, mode, fpfile, NUMBERS;
	u32 msg[MAXBYTELEN * PARALLEL_NUM/4];
	u8 *k = (u8*)msg;
	u8 *iv = (u8*)(msg + 8);
	u32 wordlen, NNN, msg_len;

#if(TOTXTFILE==1)
	char SpeedFileName[] = "ZUC256_MAC_AVX512_LINE_16_Speed_XXXXXXXX.txt";
	const char hex[16] = { 'A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P' };
	int maze;
	{
		maze = (int)time(0);
		for (i = 0; i < 8; i++)
			SpeedFileName[strlen(SpeedFileName) - 5 - i] = hex[((maze >> (4 * i)) & 0xf)];
		fopen_s(&fptxt, SpeedFileName, "w+");
	}
#endif

	//#####################################################//
	NUMBERS = 10;
	for (j = 0; j < NUMBERS; j++)
	{
		memset(msg, 0xab, MAXBYTELEN * PARALLEL_NUM);
		///////////////////////////////////////////////////////////
		for (mode = 2; mode < 3; mode++)
		{
			switch (mode)
			{
			case 0: NNN = 20;	wordlen = 256 / sizeof(u32);	break; // short message
			case 1: NNN = 19;	wordlen = 2048 / sizeof(u32);	break; // middle message
			case 2: NNN = 16;	wordlen = 9000 / sizeof(u32);	break; // long message
			}
			TIMES = 1 << NNN;
			msg_len = (wordlen - 2);
			start = clock();
			for (i = 0; i < TIMES; i++)
			{
				ZUC256_MAC_AVX512(msg, MAC_BITLENGTH, k, iv, msg, msg_len);
			}
			finish = clock();
			totaltime = (finish - start) / CLOCKS_PER_SEC;
			speed = (((double)wordlen * 32 * PARALLEL_NUM) / 1000.0)*((double)TIMES / 1000.0) / totaltime;
			evenspeed[mode] += speed;
			fpfile = 0;
#if(TOTXTFILE==1)
			for (; fpfile < 2; fpfile++)
#endif
			{
				switch (fpfile)
				{
				case 0: fp = fpscreen; break;
				case 1: fp = fptxt; break;
				}
				fprintf(fp, "\n\n ZUC256_MAC%d_AVX512_LINE_%d : one line with %d bytes massage generate %d bits MAC",
					MAC_BITLENGTH, PARALLEL_NUM, msg_len * 4, MAC_BITLENGTH);
				fprintf(fp, "\n Test Function\t ZUC256_MAC%d_AVX512", MAC_BITLENGTH);
				fprintf(fp, "\n Test Times\t 1<<%d", NNN);
				fprintf(fp, "\n Test Time\t %.3f seconds", totaltime);
				fprintf(fp, "\n Test Speed\t %.2f Gbps", speed/1000.0);
			}
		}
		///////////////////////////////////////////////////////////
		fprintf(fpscreen, "\n\n\n");
		fprintf(fptxt, "\n\n\n");
	}
	//#####################################################//
	printf("\n\n test times = %d, max even speed is %.2f Gbps\n\n", NUMBERS, evenspeed[2] / NUMBERS / 1000.0);
	totalspeed += evenspeed[2] / NUMBERS;
#if(TOTXTFILE==1)
	fclose(fptxt);
#endif
}

///////////////////////////////////////////////////////////////////////////////////////////////////////
#if single_thread
void main()
{
	ZUC256_SelfTest_AVX512();
	ZUC256_SpeedTest_AVX512();
	ZUC256_MAC_SelfTest_AVX512();
	ZUC256_MAC_SpeedTest_AVX512();
}
#endif


/****************************************************************
   Multi-threaded
*****************************************************************/
#if !single_thread
#include <Windows.h>
#include <process.h>

void main()
{
	int i, NUM = 1;
	HANDLE thread[32];
	unsigned int ID[32];
	totalspeed = 0;

	while (1)
	{
		printf("\n input process number : ");
		scanf_s("%d", &NUM);
		if (NUM < 1 || NUM>12)
			printf("\nNUM is error\n");
		else
			break;
	}

	for (i = 0; i < NUM; i++)
	{
		//printf("\n press any key to continue \n");
		//getchar();
		thread[i] = (HANDLE)_beginthreadex(NULL, 0, ZUC256_SpeedTest_AVX512, (LPVOID)NULL, 0, ID + i);
		//thread[i] = (HANDLE)_beginthreadex(NULL, 0, ZUC256_MAC_SpeedTest_AVX512, (LPVOID)NULL, 0, ID + i);
	}
	for (i = 0; i < NUM; i++)
	{
		WaitForSingleObject(thread[i], INFINITE);
	}
	for (i = 0; i < NUM; i++)
	{
		CloseHandle(thread[i]);
	}

	printf("\n\n total speed is %.2f Gbps\n\n", totalspeed/1000.0);
	printf(" press any key to end \n");
	getchar(); getchar();
}
#endif
